#| eval: true
#| message: false
library(dplyr)
library(ggplot2)
library(openintro)
library(knitr)
library(mvtnorm)
births14 <- births14[complete.cases(births14), ]
glimpse(births14)
?var
a <- rnorm(10)
var(a)
sum((a-mean(a))^2)/19
sum((a-mean(a))^2)/10
sum((a-mean(a))^2)/9
n_seq <- 1000
x <- seq(0, 30, length.out = n_seq)
prior_dens <- dgamma(x, shape = 16, rate = 2)
posterior_dens <- dgamma(x, shape = 16 + sum_y, rate = 2 + n)
visits <- births14$visits[!is.na(births14$visits)] # remove missing values
n <- length(visits)
sum_y <- sum(visits)
posterior_samples <- rgamma(50000, shape = 16 + sum_y, rate = 2 + n)
data.frame(samples = posterior_samples) |> ggplot(aes(x = samples)) +
geom_histogram(aes(y = ..density..),
colour = 1, fill = "white") +
geom_density(lwd = 1.2,
linetype = 1,
colour = "black") +
labs(x = expression(lambda),
y = "Density",
title = expression(paste("Posterior distribution of ", lambda)),
subtitle = "Rate for number of hospital visits in 2014 for each woman")
n_seq <- 1000
x <- seq(0, 30, length.out = n_seq)
prior_dens <- dgamma(x, shape = 16, rate = 2)
posterior_dens <- dgamma(x, shape = 16 + sum_y, rate = 2 + n)
dat.fig <- data.frame(x = rep(x, 2),
y = c(prior_dens, posterior_dens),
Type = rep(c("Prior", "Posterior"), each = n_seq)
)
ggplot(dat.fig, aes(x = x, y = y, color = Type)) +
geom_line(linewidth = 1.25) +
labs(x = expression(pi),
y = "Density",
subtitle = "Prior and posterior distributions with the following prior: Gamma(a = 16, b = 2)") +
theme(legend.position = "right")
ggplot(births14, aes(x = visits)) +
geom_histogram(aes(y = ..density..),
colour = 1, fill = "white") +
geom_density(lwd = 1.2,
linetype = 1,
colour = "black") +
labs(x = "Number of hospital visits per pregnancy",
y = "Density",
subtitle = "Visualization of number of visits per pregnancy in 2014")
X <- model.matrix(~ habit, data = births14) # covariate matrix
Y <- births14$weight # outcome definition
p <- ncol(X) - 1 # number of covariates (excluding the intercept)
n <- length(Y) # number of observations
sigma_beta2 <- 10
beta0 <- rep(0, p + 1)
a <- 3
b <- 1
S <- 5000
sigma2 <- exp(rnorm(1)) # initial value
samples <- NULL
for (s in 1:S) {
###Sample from full conditional for beta
var_beta <- chol2inv(chol(t(X) %*% X / sigma2 + diag(p + 1) / sigma_beta2))
mean_beta <- var_beta %*% (beta0 / sigma_beta2 + t(X) %*% Y / sigma2)
beta <- as.numeric(rmvnorm(1, mean_beta, var_beta))
###Sample from full conditional for sigma2
quadratic <- as.numeric(t(Y - X %*% beta) %*% (Y - X %*% beta))
sigma2 <- 1 / rgamma(1, shape = a + n / 2, rate = b + quadratic / 2)
###Save samples
samples <- rbind(samples, c(beta, sigma2))
}
dat.fig <- data.frame(
parameter = rep(c("beta[0]", "beta[1]", "sigma^2"), each = S),
index = rep(1:S, 3),
value = as.numeric(samples)
)
ggplot(dat.fig, aes(x = value)) +
geom_density(lwd = 1.5) +
facet_grid(. ~ parameter, labeller = label_parsed, scales = "free_x") +
ylab("Density") +
xlab("Parameter value")
ggplot(dat.fig, aes(x = index, y = value)) +
geom_line(lwd = 0.5) +
facet_grid(. ~ parameter, labeller = label_parsed, scales = "free_x") +
ylab("Parameter value") +
xlab("Sample index")
mod <- lm(weight ~ habit, data = births14)
res <- summary(mod)
print(res)
pvalue <- pt(coef(res)[, 3], mod$df, lower = TRUE)[2]
mean(samples[, 2] < 0)
R.version
n_seq <- 1000
x <- seq(0, 30, length.out = n_seq)
prior_dens <- dgamma(x, shape = 16, rate = 2)
posterior_dens <- dgamma(x, shape = 16 + sum_y, rate = 2 + n)
dat.fig <- data.frame(x = rep(x, 2),
y = c(prior_dens, posterior_dens),
Type = rep(c("Prior", "Posterior"), each = n_seq)
)
ggplot(dat.fig, aes(x = x, y = y, color = Type)) +
geom_line(linewidth = 1.25) +
labs(x = expression(pi),
y = "Density",
subtitle = "Prior and posterior distributions with the following prior: Gamma(a = 16, b = 2)") +
theme(legend.position = "right")
ggplot(births14, aes(x = visits)) +
geom_histogram(aes(y = ..density..),
colour = 1, fill = "white") +
geom_density(lwd = 1.2,
linetype = 1,
colour = "black") +
labs(x = "Number of hospital visits per pregnancy",
y = "Density",
subtitle = "Visualization of number of visits per pregnancy in 2014")
